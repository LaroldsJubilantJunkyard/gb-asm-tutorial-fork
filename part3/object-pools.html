<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Object Pools - GB ASM Tutorial</title>

        <!-- Custom HTML head -->
        <meta name="twitter:card" content="summary_large_image"/>
        <meta name="twitter:site:id" content="@gbdev0"/>
        <meta property="og:title" content="Object Pools - GB ASM Tutorial" />
        <meta property="og:image" content="https://gbdev.io/gb-asm-tutorial/assets/banner/1200x628.png" />
        <meta property="og:site_name" content="GB ASM Tutorial"/>

        <meta name="description" content="A complete guide to programming Game Boy games in assembly.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../css/custom.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="../index.html">Home</a></li><li class="chapter-item affix "><a href="../roadmap.html">Roadmap</a></li><li class="chapter-item affix "><a href="../help-feedback.html">Help</a></li><li class="chapter-item affix "><li class="part-title">Part Ⅰ — Hello World!</li><li class="chapter-item "><a href="../part1/setup.html"><strong aria-hidden="true">1.</strong> Setup</a></li><li class="chapter-item "><a href="../part1/hello_world.html"><strong aria-hidden="true">2.</strong> Hello World!</a></li><li class="chapter-item "><a href="../part1/toolchain.html"><strong aria-hidden="true">3.</strong> The toolchain</a></li><li class="chapter-item "><a href="../part1/bin_and_hex.html"><strong aria-hidden="true">4.</strong> Binary and hexadecimal</a></li><li class="chapter-item "><a href="../part1/registers.html"><strong aria-hidden="true">5.</strong> Registers</a></li><li class="chapter-item "><a href="../part1/assembly.html"><strong aria-hidden="true">6.</strong> Assembly basics</a></li><li class="chapter-item "><a href="../part1/memory.html"><strong aria-hidden="true">7.</strong> Memory</a></li><li class="chapter-item "><a href="../part1/header.html"><strong aria-hidden="true">8.</strong> The header</a></li><li class="chapter-item "><a href="../part1/operations.html"><strong aria-hidden="true">9.</strong> Operations & flags</a></li><li class="chapter-item "><a href="../part1/jumps.html"><strong aria-hidden="true">10.</strong> Jumps</a></li><li class="chapter-item "><a href="../part1/tracing.html"><strong aria-hidden="true">11.</strong> Tracing</a></li><li class="chapter-item "><div><strong aria-hidden="true">12.</strong> Graphics</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../part1/tiles.html"><strong aria-hidden="true">12.1.</strong> Tiles</a></li><li class="chapter-item "><a href="../part1/palettes.html"><strong aria-hidden="true">12.2.</strong> Palettes</a></li><li class="chapter-item "><a href="../part1/tilemap.html"><strong aria-hidden="true">12.3.</strong> Tilemap</a></li></ol></li><li class="chapter-item "><a href="../part1/wrapup.html"><strong aria-hidden="true">13.</strong> Wrapping up</a></li><li class="chapter-item affix "><li class="part-title">Part Ⅱ — Our first game</li><li class="chapter-item "><a href="../part2/getting-started.html"><strong aria-hidden="true">14.</strong> Getting started</a></li><li class="chapter-item "><a href="../part2/objects.html"><strong aria-hidden="true">15.</strong> Objects</a></li><li class="chapter-item "><a href="../part2/functions.html"><strong aria-hidden="true">16.</strong> Functions</a></li><li class="chapter-item "><a href="../part2/input.html"><strong aria-hidden="true">17.</strong> Input</a></li><li class="chapter-item "><a href="../part2/collision.html"><strong aria-hidden="true">18.</strong> Collision</a></li><li class="chapter-item "><a href="../part2/bricks.html"><strong aria-hidden="true">19.</strong> Bricks</a></li><li class="chapter-item "><a href="../part2/wip.html"><strong aria-hidden="true">20.</strong> Work in progress</a></li><li class="chapter-item affix "><li class="part-title">Part III — Our second game</li><li class="chapter-item "><a href="../part3/getting-started.html"><strong aria-hidden="true">21.</strong> Getting Started</a></li><li class="chapter-item "><a href="../part3/the-starter.html"><strong aria-hidden="true">22.</strong> Download the Starter</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../part3/project-structure.html"><strong aria-hidden="true">22.1.</strong> Project Structure</a></li><li class="chapter-item "><a href="../part3/dependent-libraries.html"><strong aria-hidden="true">22.2.</strong> Dependent Libraries</a></li><li class="chapter-item "><a href="../part3/sprites-backgrounds.html"><strong aria-hidden="true">22.3.</strong> Sprites & Backgrounds</a></li><li class="chapter-item "><a href="../part3/sporbs-metasprites.html"><strong aria-hidden="true">22.4.</strong> Metasprites</a></li><li class="chapter-item "><a href="../part3/drawing-text.html"><strong aria-hidden="true">22.5.</strong> Drawing Text</a></li><li class="chapter-item "><a href="../part3/utilities.html"><strong aria-hidden="true">22.6.</strong> Included Utilities</a></li><li class="chapter-item "><a href="../part3/compilation.html"><strong aria-hidden="true">22.7.</strong> Compilation</a></li></ol></li><li class="chapter-item "><a href="../part3/game-state-management.html"><strong aria-hidden="true">23.</strong> Game State Management</a></li><li class="chapter-item "><a href="../part3/title-screen.html"><strong aria-hidden="true">24.</strong> Title Screen</a></li><li class="chapter-item "><a href="../part3/story-screen.html"><strong aria-hidden="true">25.</strong> Story Screen</a></li><li class="chapter-item expanded "><a href="../part3/gameplay.html"><strong aria-hidden="true">26.</strong> Gameplay</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../part3/object-pools.html" class="active"><strong aria-hidden="true">26.1.</strong> Object Pools</a></li><li class="chapter-item "><a href="../part3/scrolling-background.html"><strong aria-hidden="true">26.2.</strong> Scrolling Background</a></li><li class="chapter-item "><a href="../part3/heads-up-interface.html"><strong aria-hidden="true">26.3.</strong> Heads-Up Interface</a></li><li class="chapter-item "><a href="../part3/the-player.html"><strong aria-hidden="true">26.4.</strong> The Player</a></li><li class="chapter-item "><a href="../part3/bullets.html"><strong aria-hidden="true">26.5.</strong> Bullets</a></li><li class="chapter-item "><a href="../part3/enemies.html"><strong aria-hidden="true">26.6.</strong> Enemies</a></li><li class="chapter-item "><a href="../part3/collision.html"><strong aria-hidden="true">26.7.</strong> Collision Detection</a></li><li class="chapter-item "><a href="../part3/collision.html"><strong aria-hidden="true">26.8.</strong> Enemy Collisions</a></li></ol></li><li class="chapter-item "><a href="../part3/conclusion.html"><strong aria-hidden="true">27.</strong> Conclusion</a></li><li class="chapter-item affix "><a href="../next.html">Where to go next</a></li><li class="chapter-item affix "><a href="../resources.html">Resources</a></li><li class="chapter-item affix "><a href="../thanks.html">Thanks</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">GB ASM Tutorial</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        <button id="language-toggle" class="icon-button" type="button"
                                title="Change language" aria-label="Change language"
                                aria-haspopup="true" aria-expanded="false"
                                aria-controls="language-list">
                            <i class="fa fa-globe"></i>
                        </button>
                        <ul id="language-list" class="theme-popup" aria-label="Languages" role="menu">
                          <li role="none"><button role="menuitem" class="theme">
                              <a id="en">English</a>
                          </button></li>
                          <li role="none"><button role="menuitem" class="theme">
                              <a id="it">Italian</a>
                          </button></li>
                        </ul>

                        <script>
                          let langToggle = document.getElementById("language-toggle");
                          let langList = document.getElementById("language-list");
                          langToggle.addEventListener("click", (event) => {
                              langList.style.display = langList.style.display == "block" ? "none" : "block";
                          });
                          let selectedLang = document.getElementById("en");
                          selectedLang.parentNode.classList.add("theme-selected");

                          // The path to the root, taking the current
                          // language into account.
                          let full_path_to_root = "../";
                          // The page path (mdbook only gives us
                          // access to the path to the Markdown file).
                          let path = "part3/object-pools.md".replace(/\.md$/, ".html");
                          for (let lang of langList.querySelectorAll("a")) {
                              if (lang.id == "en") {
                                  lang.href = `${full_path_to_root}${path}`;
                              } else {
                                  lang.href = `${full_path_to_root}${lang.id}/${path}`;
                              }
                          }
                        </script>

                        
                        <a href="https://github.com/gbdev/gb-asm-tutorial" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/gbdev/gb-asm-tutorial/edit/master/src/part3/object-pools.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="object-pools"><a class="header" href="#object-pools">Object Pools</a></h1>
<p>Galactic Armada will use a single “object pool” for all obejcts (the player, enemies, and bullets). This pool repsents an array of objects, but is realy just a collection of bytes. Each object has the same number of bytes allocated for it. </p>
<ul>
<li>Active (1 byte)</li>
<li>Y Position (2 bytes)</li>
<li>X Position (2 bytes)</li>
<li>Metasprite address (2 bytes)</li>
<li>Health (1 byte)</li>
<li>Update function address (2 bytes)</li>
<li>Damage Timer (1 byte)</li>
</ul>
<p>We’ve pre-defined that in the starter. </p>
<p><em>inside of our <code>constants.inc</code> include file:</em></p>
<pre><code class="language-rgbasm linenos start=9">
; from https://rgbds.gbdev.io/docs/v0.6.1/rgbasm.5#EXPRESSIONS
; The RS group of commands is a handy way of defining structure offsets:
RSRESET
DEF object_activeByte            RB   1
DEF object_yLowByte              RB   1
DEF object_yHighByte             RB   1
DEF object_xLowByte              RB   1
DEF object_xHighByte             RB   1
DEF object_metaspriteLowByte     RB   1
DEF object_metaspriteHighByte    RB   1
DEF object_healthByte            RB   1
DEF object_updateLowByte         RB   1
DEF object_updateHighByte        RB   1
DEF object_damageByte            RB   1
DEF PER_OBJECT_BYTES_COUNT       RB   0
</code></pre>
<p>We need to next setup and implement variables that use that structure.</p>
<p><strong>Create a file called <code>object-pool.asm</code>, add the following code to it:</strong></p>
<pre><code class="language-rgbasm linenos start=1">include &quot;src/main/includes/hardware.inc&quot;
include &quot;src/main/includes/constants.inc&quot;

SECTION &quot;ObjectVariables&quot;, WRAM0

wObjects:: ds MAX_OBJECT_COUNT*PER_OBJECT_BYTES_COUNT
wObjectsEnd:: db
wObjectsFlash:: db

SECTION &quot;Objects&quot;, ROM0

</code></pre>
<p>We’ll explain each variable soon, but notice how we allocated space in WRAM for <code>wObjects</code>. Rather than using a literal number for how many objects our game can handle, we use the constant <code>MAX_OBJECT_COUNT</code>. This constant is declared in <code>constants.inc</code>, and prevents any sort of inconsistincies if we change our minds.</p>
<h2 id="initializing-the-object-pool"><a class="header" href="#initializing-the-object-pool">Initializing the object pool</a></h2>
<p>When we initialize the object pool, we need to do 2 primary things:</p>
<ul>
<li>Set all bytes in the pool to 0</li>
<li>Set our <code>wObjectsEnd</code> variable to 255</li>
</ul>
<p>Our <code>wObjectsEnd</code> variable is used to simplify looping through all objects. More on that later.</p>
<p><strong>Add the following code to the bottom of your <code>object-pool.asm</code> file:</strong></p>
<pre><code class="language-rgbasm linenos start=13">InitializeObjectPool::

    ; The active byte will awlays be 0 or 1
    ; When looping through the wObjects, if we read 255 we've reached wObjectsEnd
    ld a, 255
    ld [wObjectsEnd], a

    ld hl, wObjects
    ld b, MAX_OBJECT_COUNT

InitializeObjectPool_Loop:

    ld a, 0

    ; Default each byte as 0
    ; Using REPT incase the object size changes
    REPT PER_OBJECT_BYTES_COUNT
    ld [hli], a
    ENDR

    ; Decrease how many we have to initialize
    ; Stop this loop when b reaches zero
    ld a, b
    dec a
    and a
    ret z

    ld b, a
    jp InitializeObjectPool_Loop
</code></pre>
<p>The above code is just going to loop through each object, and set all of it’s bytes to 0.</p>
<h2 id="updating-objects-in-our-object-pool"><a class="header" href="#updating-objects-in-our-object-pool">Updating objects in our object pool</a></h2>
<p>We’ve created a variable called <code>wObjectsFlash</code>. This will be used as a counter. We’ll increase it each frame. Because it’s a a unsigned 8-bit integer, it’s values will be between 0 and 255. Later, When it’s value is larger than 128, any object that is damaged will not be shown. This overall creates a “blinking” damaged effect.</p>
<pre><code class="language-rgbasm linenos start=43">UpdateObjectPool::

    ; Increase our flash
    ld a, [wObjectsFlash]
    add a,25
    ld [wObjectsFlash], a
</code></pre>
<p>We’re going to loop through each object in our object pool. Our <code>wObjectsEnd</code> variable is used to simplify looping through all objects. When iterating through our <code>wObjects</code>, the first byte for an object is the active byte (aka <code>object_activeByte</code> in constants.inc). The valid values of this byte are 0 and 1. If the code reads a 255 (from <code>wObjectsEnd</code>), then we know we’ve reached the end of the bytes associated with our object pool.</p>
<p>If we haven’t read 255 yet, then we need to check if the current object is active. We can use <code>and a</code> (where the value in the ‘a’ register comes from the previous ‘ld’ instruction). If the zero flag is set, then that object is inactive and we’ll jump to the next object.</p>
<p>The Code will proceed on, if the object is active.</p>
<pre><code class="language-rgbasm linenos start=50">
    ld hl, wObjects

UpdateObjectPool_Loop:

    ; The active byte should be 0 or 1
    ; When we reach a 255, we've reached the wObjectsEnd
    ld a, [hl]
    cp a, 255
    ret z

    ; Check if the object is active
    and a
    jp z, UpdateObjectPool_GoToNextObject

</code></pre>
<p>The first thing we’ll do for an active object is call it’s update function. We’ll copy the address of that function into it ‘hl’ and call it. Before such, we need to push hl onto the stack. When we’re done calling our object’s update function, we’ll pop it off the stack.</p>
<blockquote>
<p><strong>Note:</strong> Before we change ‘hl’, we’ll copy it’s value into ‘bc’. For each object’s update function, ‘bc’ will have the address of that object’s first byte.</p>
</blockquote>
<p>After updating, we want to draw the object. Before so, we need to check if the object is inactive. If so, we’ll avoid drawing and jump to the next object.</p>
<pre><code class="language-rgbasm linenos start=66">.UpdateObject
        
    push hl

    ld b, h
    ld c, l

    ; Move to the update
    ld de, object_updateLowByte
    add hl, de

    ; hl points to the low byte for the address of the update function
    ; copy that address INTO hl
    ld a, [hli]
    ld h, [hl]
    ld l, a

    call callHL

    pop hl

    ; Check if we're inactive after updating
    ld a, [hl]
    and a
    jp z , UpdateObjectPool_GoToNextObject
</code></pre>
<p>AFter updating, if our object is still active, we’ll conditionally draw the object. Now we’re going to put into use the previously mentioned <code>wObjectsFlash</code> variable.</p>
<p>Each object has a damage byte (aka <code>object_damageByte</code> in constants.inc). If this byte is non-zero, the associated object has been damaged and we want it to blink. We’ll skip drawing the object if the damage byte is non-zero and the <code>wObjectsFlash</code> variable is greater than 128.</p>
<pre><code class="language-rgbasm linenos start=92">.CheckIsDamaged

    push hl

    ; Move to the y low byte
    ld de, object_damageByte
    add hl, de

    ; Check this object is damaged
    ld a, [hl]
    and a
    jp z, NotDamaged
    jp Damaged

Damaged:

    ; decrease our damage byte
    dec a
    ld [hl], a

    pop hl

    ; if our objects timer is greater than 0 we'll not draw
    ld a, [wObjectsFlash]
    cp a, 128

    jp c, UpdateObjectPool_GoToNextObject

NotDamaged:

    pop hl
    jp z, GetXAndY
</code></pre>
<p>For drawing our object, we’ll use the <code>RenderMetasprite</code> function from Evieue’s Sprite Object library. This function requires the following parameters:</p>
<ul>
<li>the Q12.4 Fixed-point y position in bc</li>
<li>The Q12.4 fixed-point X position in de</li>
<li>The Pointer to current metasprite in hl</li>
</ul>
<p>To prepare for that function, we’ll copy bytes from our object to the proper registers.</p>
<blockquote>
<p><strong>Note:</strong> After copying our x position to de, our ‘hl’ registers are not exactly what we need for <code>RenderMetasprite</code>. At that point in time, ‘hl’ doesn’t contain the address of our metasprite. It contains a pointer to that address.</p>
</blockquote>
<p>After rendering our metasprite, we’ll pop the start of our metasprite off the stack. This makes going to the next object simple. With ‘hl’ pointing to our object’s first byte, we simply need to increment ‘hl’</p>
<pre><code class="language-rgbasm linenos start=125">GetXAndY:

    push hl

    ; Move to the y low byte
    ld de, object_yLowByte
    add hl, de

    ; Copy our y position to bc
    ld a, [hli]
    ld c, a
    ld a, [hli]
    ld b, a

    ; Copy our x position to de
    ld a, [hli]
    ld e, a
    ld a, [hli]
    ld d, a

.RenderObjectMetasprite
    ld a, [hli]
    ld h, [hl]
    ld l, a

    call RenderMetasprite

    pop hl

    jp UpdateObjectPool_GoToNextObject
</code></pre>
<p>When ‘hl’ points to the first byte of an object ,we can easily move on to the next object. This is done by adding to it: the dynamic constant <code>PER_OBJECT_BYTES_COUNT</code> (from constants.inc). From there, we’ll go back to our <code>UpdateObjectPool_Loop</code> label and repeat until we read 255.</p>
<pre><code class="language-rgbasm linenos start=155">UpdateObjectPool_GoToNextObject:

    ld de, PER_OBJECT_BYTES_COUNT
    add hl, de

    jp UpdateObjectPool_Loop
</code></pre>
<h2 id="getting-an-inactive-object"><a class="header" href="#getting-an-inactive-object">Getting an inactive object</a></h2>
<p>When firing bullets and/or when spawning enemies, we’ll need to find an object in our pool that is inactive. For this, we’ll create a function called <code>GetNextAvailableObject_InHL</code></p>
<p>This function takes two parameters</p>
<ul>
<li>the starting byte in hl</li>
<li>how many objects to check in b</li>
</ul>
<p>When this function is done, if the zero flag is not set: an inactive object has been found. At that point in time, ‘hl’ will point to the first byte of that object.</p>
<pre><code class="language-rgbasm linenos start=162">; parameters
; hl = start of array bytes
; b = number of objects to check
; example:
; ld hl, wObjects+BULLETS_START
; ld b, MAX_BULLET_COUNT
GetNextAvailableObject_InHL::

GetNextAvailableObject_Loop:

    ld a, [hl]
    and a
    jp nz, GetNextAvailableObject_Next


    ld a, 1
    and a
    ret

GetNextAvailableObject_Next:

    ld a, b
    dec a
    ld b, a

    jp z, GetNextAvailableObject_End

    ; move to the next object
    ld de, PER_OBJECT_BYTES_COUNT
    add hl, de

    jp GetNextAvailableObject_Loop
GetNextAvailableObject_End:

    ld a, 0
    and a
    ret;
</code></pre>
<p>Later, when spawning bullets, we’ll call that function like so:</p>
<p><em>This code will be covered later</em></p>
<pre><code class="language-rgbasm linenos start=45">FireNextBullet::

    ld hl, wObjects+BULLETS_START
    ld b, MAX_BULLET_COUNT

    ; Get the next available bullet, and put it's address in hl
    ; if the zero flag is set, stop early
    call GetNextAvailableObject_InHL
    ret z

    ; ... More FireNextBullet logic
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../part3/gameplay.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../part3/scrolling-background.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../part3/gameplay.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../part3/scrolling-background.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../js/linenos.js"></script>


    </body>
</html>
